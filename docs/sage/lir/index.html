<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="LIR (Low Intermediate Representation) Module"><meta name="keywords" content="rust, rustlang, rust-lang, lir"><title>sage::lir - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-93196c7a1c3542a8.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../static.files/light-4743e13df3dfe8c4.css"><link rel="stylesheet" disabled href="../../static.files/dark-0e1b889528bd466b.css"><link rel="stylesheet" disabled href="../../static.files/ayu-65289d5d067c7c66.css"><script id="default-settings" ></script><script src="../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../../static.files/main-3367e395607fafc1.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../sage/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../sage/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module lir</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">sage</a>::<wbr><a class="mod" href="#">lir</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/sage/lir/mod.rs.html#1-165">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="lir-low-intermediate-representation-module"><a href="#lir-low-intermediate-representation-module">LIR (Low Intermediate Representation) Module</a></h2>
<p>This module contains a decently sized typechecked intermediate representation for the virtual machine.
The LIR, unlike the VM and the assembly language, is <em>not</em> split into two variants: there is only one variant.
The LIR compiler will generate core assembly code <em>by default</em> for the LIR, but will revert to the standard
variant if unsupported instructions or types are encountered (such as floating point operations or float types).</p>
<h3 id="index"><a href="#index">Index</a></h3>
<ol>
<li><a href="./enum.Type.html">Types</a></li>
<li><a href="./enum.ConstExpr.html">Constants</a> and <a href="./enum.Expr.html">Expressions</a></li>
<li><a href="struct.CoreBuiltin.html">Core Builtins</a> and <a href="struct.StandardBuiltin.html">Standard Builtins</a></li>
<li><a href="./enum.Error.html">Compilation Errors</a></li>
</ol>
<h3 id="purpose"><a href="#purpose">Purpose</a></h3>
<p>The purpose of the LIR is to provide a powerful backend for the next stage of IR. Most of the heavy lifting
of the actual compilation process is done by this stage of the compiler: typechecking, constant folding,
compiling to assembly, dealing with the two variants of the virtual machine, and so on. The stages of IR
above this simply implement features like macros and tagged-unions: very simple things which map 1:1 with
generated LIR code.</p>
<h3 id="features"><a href="#features">Features</a></h3>
<ol>
<li>The Type System</li>
</ol>
<p>LIR’s type system is very good for compiling directly to assembly. LIR supports the following types:</p>
<ul>
<li>None (the void type)</li>
<li>Never (the type of an expression which never returns a value: such as a <code>return</code> expression)</li>
<li>Int (a signed integer)</li>
<li>Float (a floating point number)</li>
<li>Bool (a boolean value)</li>
<li>Char (a single character)</li>
<li>Cell (the most basic unit of memory)</li>
<li>Pointer (a pointer to another given type)</li>
<li>Array (an array with elements, with a constant size expression)</li>
<li>Proc (a procedure with a list of arguments and a return type)</li>
<li>Tuple (a tuple with a list of distinct types. this is the product type)</li>
<li>Struct (a tuple with named fields)</li>
<li>Union (a union of types. this is the sum type when combined with a tag)</li>
<li>Enum (an enumeration with a list of variants. this is like a C enum, not a Rust enum)</li>
<li>Let (a type which allows the user to bind a type under a given name in another type expression)</li>
</ul>
<p>The Let type is extremely powerful, allowing users to create recursive types <em>inline</em>: without
binding them to a name under a LetType expression. Additionally, Let types are checked for equality
<em>structurally</em>, and this also works for comparing recursive types. There are many examples of this in <code>tests/lir.rs</code>.</p>
<ol start="2">
<li>The Constant Folding</li>
</ol>
<p>LIR also provides constant expressions to allow the user to do as much as possible during compile time.
This also makes it simpler to do compile-time optimizations.</p>
<ol start="3">
<li>Expressions</li>
</ol>
<p>The expressions that LIR uses to represent the program are very simple, and very powerful.
Arrays are kept distinct from Pointers (unlike in C), and so expressions can return stack allocated arrays without a problem.
Arrays can also be indexed without a pointer to the array, and so on. LIR supports getting members of tuples, structs,
and unions, and also getting their references as well.</p>
<ol start="4">
<li>Compilation Process</li>
</ol>
<p>LIR is designed to be able to compile <em>as much as possible</em> to the core variant of the assembly language. As long as you don’t
use floating point operations or standard builtins (<code>alloc</code> and <code>free</code>), you can compile to the core variant. Recursive types,
<em>inlined</em> recursive types, mutually recursive types, recursive functions, and core builtins are all supported without a problem.
<strong>The LIR compiler will only use a standard instruction if it has to.</strong></p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.And.html" title="sage::lir::And struct">And</a></div><div class="item-right docblock-short">A boolean “And” operation between two values.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Assign.html" title="sage::lir::Assign struct">Assign</a></div><div class="item-right docblock-short">An assignment operation. This is used to implement assignment operators like <code>+=</code>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CoreBuiltin.html" title="sage::lir::CoreBuiltin struct">CoreBuiltin</a></div><div class="item-right docblock-short">A builtin pseudo-procedure implemented in the core assembly variant.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Env.html" title="sage::lir::Env struct">Env</a></div><div class="item-right docblock-short">An environment under which expressions and types are compiled and typechecked.
This is essentially the scope of an expression.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Not.html" title="sage::lir::Not struct">Not</a></div><div class="item-right docblock-short">A boolean “Not” operation on a value.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Or.html" title="sage::lir::Or struct">Or</a></div><div class="item-right docblock-short">A boolean “Or” operation between two values.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Procedure.html" title="sage::lir::Procedure struct">Procedure</a></div><div class="item-right docblock-short">A procedure of LIR code which can be applied to a list of arguments.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.StandardBuiltin.html" title="sage::lir::StandardBuiltin struct">StandardBuiltin</a></div><div class="item-right docblock-short">A builtin pseudo-procedure implemented in the standard assembly variant.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Arithmetic.html" title="sage::lir::Arithmetic enum">Arithmetic</a></div><div class="item-right docblock-short">An arithmetic operation.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Comparison.html" title="sage::lir::Comparison enum">Comparison</a></div><div class="item-right docblock-short">A comparison operation between two values.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.ConstExpr.html" title="sage::lir::ConstExpr enum">ConstExpr</a></div><div class="item-right docblock-short">A compiletime expression.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="sage::lir::Error enum">Error</a></div><div class="item-right docblock-short">An LIR compilation error.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Expr.html" title="sage::lir::Expr enum">Expr</a></div><div class="item-right docblock-short">TODO: Add variants for <code>LetProc</code>, <code>LetVar</code>, etc. to support multiple definitions.
This way, we don’t overflow the stack with several clones of the environment.
A runtime expression.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Pattern.html" title="sage::lir::Pattern enum">Pattern</a></div><div class="item-right docblock-short">A pattern which can be matched against an expression.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Put.html" title="sage::lir::Put enum">Put</a></div><div class="item-right docblock-short">Print a value to a given output.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Type.html" title="sage::lir::Type enum">Type</a></div><div class="item-right docblock-short">The representation of a type in the LIR type system.</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.AssignOp.html" title="sage::lir::AssignOp trait">AssignOp</a></div><div class="item-right docblock-short">A trait used to implemented an assignment operation.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.BinaryOp.html" title="sage::lir::BinaryOp trait">BinaryOp</a></div><div class="item-right docblock-short">A trait used to implement a binary operation.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Compile.html" title="sage::lir::Compile trait">Compile</a></div><div class="item-right docblock-short">A trait which allows an LIR expression to be compiled to one of the
two variants of the assembly language.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.GetSize.html" title="sage::lir::GetSize trait">GetSize</a></div><div class="item-right docblock-short">Get the size of something in memory (number of cells).</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.GetType.html" title="sage::lir::GetType trait">GetType</a></div><div class="item-right docblock-short">Get the type associated with a value under a given environment.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Simplify.html" title="sage::lir::Simplify trait">Simplify</a></div><div class="item-right docblock-short">Simplify an expression while maintaining structural equality.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.TernaryOp.html" title="sage::lir::TernaryOp trait">TernaryOp</a></div><div class="item-right docblock-short">A trait used to implement a ternary operation.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.TypeCheck.html" title="sage::lir::TypeCheck trait">TypeCheck</a></div><div class="item-right docblock-short">A trait used to enforce type checking.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.UnaryOp.html" title="sage::lir::UnaryOp trait">UnaryOp</a></div><div class="item-right docblock-short">A trait used to implement a unary operation.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="sage" data-themes="" data-resource-suffix="" data-rustdoc-version="1.68.1 (8460ca823 2023-03-20)" data-search-js="search-98d53477a794af0b.js" data-settings-js="settings-c3c521c753752a1a.js" data-settings-css="settings-08ddfdda51b8ee2e.css" ></div></body></html>